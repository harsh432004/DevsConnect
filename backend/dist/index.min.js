"use strict";var express=require("express"),cors=require("cors"),cookieParser=require("cookie-parser"),rateLimit=require("express-rate-limit"),connectDB=require("./config/database"),_require=require("./config/redis"),redisClient=_require.redisClient,logger=require("./utils/logger"),authRouter=require("./routes/auth"),profileRouter=require("./routes/profile"),requestRouter=require("./routes/request"),userRouter=require("./routes/user"),analyticsLogger=require("./utils/analyticsLogger"),activity=require("./routes/activity"),metricsRouter=require("./routes/metrics"),client=require("prom-client"),responseTime=require("response-time"),app=express(),PORT=process.env.PORT||7777,collectMetrics=client.collectDefaultMetrics;collectMetrics({register:client.register});var trackTime=new client.Histogram({name:"track_all_req_res_time",help:"Tracking all the Request and Responce Time",labelNames:["method","route","status_code"],buckets:[1,50,100,200,400,500,800,1e3,2e3]}),trackTotalRequest=new client.Counter({name:"track_total_request",help:"This will track total request"}),allowedOrigins=["https://intrest-fusion-frontend.vercel.app","https://another-frontend.vercel.app","http://localhost:5173","http://localhost:3000"];app.use(cors({origin:allowedOrigins,credentials:!0})),app.use(responseTime(function(e,r,t){trackTotalRequest.inc(),trackTime.labels({method:e.method,route:e.url,status_code:r.statusCode}).observe(t)}));var apiLimiter=rateLimit({windowMs:36e5,max:5e3,message:"Too many requests, please try again later."});app.use(apiLimiter),app.use(express.json()),app.use(cookieParser()),app.use(analyticsLogger),app.use("/",authRouter),app.use("/",profileRouter),app.use("/",requestRouter),app.use("/",userRouter),app.use("/api/",activity),app.use("/",metricsRouter),app.get("/",function(e,r){r.send("Server is running")});var startServer=function(){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,regeneratorRuntime.awrap(connectDB());case 3:logger.info("Database connection established...."),logger.info("‚úÖ Redis connection established..."),app.get("/",function(e,r){r.send("Welcome to Internet Fusion API"),logger.info("Welcome to Internet Fusion API")}),app.listen(PORT,function(){logger.info("üöÄ Server is running on port ".concat(PORT,"..."))}),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),logger.error("‚ùå Failed to start the server:",e.t0.message);case 12:case"end":return e.stop()}},null,null,[[0,9]])};startServer();
//# sourceMappingURL=index.min.js.map
